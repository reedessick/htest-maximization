#!/bin/bash

### a simple script to generate random realizations from the Poisson model and processes them with the H-test selection algorithm
### Reed Essick (reed.essick@gmail.com)

#-------------------------------------------------

### generate many realizations from the same process

for seed in $(seq 1 100)
do
    tag="seed-$seed"
    outdir="output/$tag"

    echo "-------------------------"
    echo "    processing: $tag"
    echo "-------------------------"

    ### predict file names
    all="${tag}/make-data_${tag}.hdf5"
    subset="${tag}/downselect-data_${tag}.hdf5"

    ### generate synthetic data realizations
    ./make-data \
        --output-dir $outdir \
        --tag $tag \
        --seed $seed \
        --num-trials 1000 \
        --noise-mean-differential-rate 50.0 \
        --signal-mean-differential-rate 1.0 \
        --periodic-signal-component 1 0.3 0.0 \
        --periodic-signal-component 2 0.5 0.0 \
        --periodic-signal-component 4 0.2 0.75 \
        --Verbose \
        --histogram

    ### make basic plots summarizing the detection statistics and downselecting data
    ./downselect-data \
        $all \
        --output-dir $outdir \
        --tag $tag \
        --Verbose \
        --trajectory 

    ### actually fit the data and determine whether there are biases

    # fit all data
    echo \
    ./fit-data \
        $all \
        --output-dir $outdir \
        --tag $tag-all \
        --Verbose

    # fit the selected subset of data
    echo \
    ./fit-data \
        $subset \
        --output-dir $outdir \
        --tag $tag-subset \
        --Verbose

done

#-------------------------------------------------

echo "-------------------------"
echo "summarizing experiments"

### FIXME:
# once this is done for all the realizations, we should write a script that compares them (ie, plots)
